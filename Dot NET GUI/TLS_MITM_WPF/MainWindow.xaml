<Window x:Class="TLS_MITM_WPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TLS_MITM_WPF"
        mc:Ignorable="d"
        Title="TLS MITM Proxy Controller" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        Foreground="#E0E0E0"
        UseLayoutRounding="True">
    <Window.Resources>
        <!-- Dark Theme Resources -->        <SolidColorBrush x:Key="DarkBackground" Color="#1E1E1E"/>
        <SolidColorBrush x:Key="DarkPanelBackground" Color="#252526"/>
        <SolidColorBrush x:Key="MenuBackground" Color="#333333"/>
        <SolidColorBrush x:Key="TextColor" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="AccentColor" Color="#570987"/>
        <SolidColorBrush x:Key="SecondaryAccent" Color="#570987"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#3E3E3E"/>

        <!-- ComboBox Toggle Button Template -->
        <ControlTemplate x:Key="ComboBoxToggleButtonTemplate" TargetType="ToggleButton">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="20" />
                </Grid.ColumnDefinitions>
                <Border Grid.ColumnSpan="2"
                       Background="{TemplateBinding Background}"
                       BorderBrush="{TemplateBinding BorderBrush}"
                       BorderThickness="{TemplateBinding BorderThickness}" />

                <Border Grid.Column="1"
                       Margin="1"
                       Background="{TemplateBinding Background}">
                    <Path Name="Arrow"
                         Fill="{StaticResource TextColor}"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         Data="M 0 0 L 4 4 L 8 0 Z"/>
                </Border>
            </Grid>            <ControlTemplate.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource AccentColor}" />
                    <Setter TargetName="Arrow" Property="Fill" Value="White" />
                </Trigger>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource AccentColor}" />
                </Trigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>

        <!-- Button Style -->
        <Style x:Key="DarkMenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5,5"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#444444"/>
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#222222"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBlock Style -->
        <Style x:Key="DarkTextBlockStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
        </Style>        <!-- TextBox Style -->
        <Style x:Key="DarkTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="CaretBrush" Value="{StaticResource TextColor}"/>
            <Setter Property="SelectionBrush" Value="{StaticResource AccentColor}"/>
            <Setter Property="SelectionOpacity" Value="0.7"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                </Trigger>
                <Trigger Property="IsKeyboardFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                </Trigger>
            </Style.Triggers>
        </Style><!-- ComboBox Style -->
        <Style x:Key="DarkComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>

            <!-- Override the control template to ensure dark styling throughout -->
            <Setter Property="Template">
                <Setter.Value>                    <ControlTemplate TargetType="ComboBox">
                        <Grid Name="MainGrid">
                            <ToggleButton IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                         Name="ToggleButton"
                                         Template="{StaticResource ComboBoxToggleButtonTemplate}"
                                         Background="{TemplateBinding Background}"
                                         BorderBrush="{TemplateBinding BorderBrush}"
                                         BorderThickness="{TemplateBinding BorderThickness}"
                                         Focusable="false"
                                         ClickMode="Press"/>

                            <ContentPresenter Name="ContentSite"
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Left"
                                            Margin="10,3,30,3"/>

                            <!-- Dropdown popup -->
                            <Popup Name="PART_Popup"
                                  IsOpen="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                  AllowsTransparency="True"
                                  PopupAnimation="Slide"
                                  Focusable="False"
                                  Placement="Bottom">
                                <Border Background="#2D2D30"
                                       BorderBrush="#3F3F46"
                                       BorderThickness="1"
                                       MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                       MinWidth="{Binding ActualWidth, ElementName=MainGrid}">
                                    <ScrollViewer SnapsToDevicePixels="True"
                                                 Margin="0"
                                                 Background="#2D2D30">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                            <Trigger Property="HasItems" Value="false">
                                <Setter TargetName="PART_Popup" Property="IsOpen" Value="false" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
              <!-- Style the dropdown items -->
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ComboBoxItem">
                        <Setter Property="Background" Value="#2D2D30"/>
                        <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
                        <Setter Property="Padding" Value="5,3"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBoxItem">
                                    <Border Name="Border"
                                           Background="{TemplateBinding Background}"
                                           BorderThickness="0"
                                           Padding="{TemplateBinding Padding}">
                                        <ContentPresenter />
                                    </Border>                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#3E3E40"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Border" Property="Background" Value="#007ACC"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Foreground" Value="#666666"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>        <!-- ListView Style -->
        <Style x:Key="DarkListViewStyle" TargetType="ListView">
            <Setter Property="Background" Value="#252526"/>
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
        </Style>

        <!-- GridViewColumnHeader Style (for ListView headers) -->
        <Style x:Key="GridViewColumnHeaderStyle" TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                    <Setter Property="Foreground" Value="#570987"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- GroupBox Style -->
        <Style x:Key="DarkGroupBoxStyle" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
        </Style>        <!-- CheckBox Style -->
        <Style x:Key="DarkCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
        </Style>
          <!-- Standard Button Style for all regular buttons (non-menu buttons) -->
        <Style x:Key="DarkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="{StaticResource TextColor}"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#3E3E42"/>
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#222222"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Green button style for Start functions -->
        <Style x:Key="GreenButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#0E6027"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#128A38"/>
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#084016"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Red button style for Stop functions -->
        <Style x:Key="RedButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#8B2E2E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#A83232"/>
                                <Setter Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#5A1E1E"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Background="{StaticResource DarkBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Menu Bar -->
        <Border Grid.Row="0" Background="{StaticResource MenuBackground}" BorderBrush="#555555"
                BorderThickness="0,0,0,1">
            <Grid Margin="10,5">
                <!-- Navigation Menu -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">                    <Button Name="ProxyControlButton" Content="Proxy Control"
                            Style="{StaticResource DarkMenuButtonStyle}"
                            Click="NavigationButton_Click" Tag="ProxyControl"/>
                    <Button Name="ConnectionsButton" Content="Connections"
                            Style="{StaticResource DarkMenuButtonStyle}"
                            Click="NavigationButton_Click" Tag="Connections"/>
                    <Button Name="ProxyHistoryButton" Content="Proxy History"
                            Style="{StaticResource DarkMenuButtonStyle}"
                            Click="NavigationButton_Click" Tag="ProxyHistory"/>                </StackPanel>
            </Grid>
        </Border>        <!-- Main Content Area -->
        <Grid Grid.Row="1" Margin="20">
            <!-- Proxy Control Panel -->            <Grid Name="ProxyControlPanel" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Proxy Control" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"
                           Grid.Row="0" Style="{StaticResource DarkTextBlockStyle}"/>

                <Grid Grid.Row="1">
                    <StackPanel>
                        <TextBlock Text="Proxy Configuration" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"
                                   Style="{StaticResource DarkTextBlockStyle}"/>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>                            <TextBlock Text="Bind Address:" VerticalAlignment="Center" Margin="0,0,10,0"
                                       Style="{StaticResource DarkTextBlockStyle}"/>
                            <ComboBox Name="BindAddressComboBox" Grid.Column="1" Height="25"
                                     Style="{StaticResource DarkComboBoxStyle}"/>                            <Button Name="RefreshInterfacesButton" Content="Refresh Interfaces" Grid.Column="2"
                                    Margin="5,0,0,0" Click="RefreshInterfaces_Click" Padding="8,0"
                                    Style="{StaticResource DarkButtonStyle}"/>
                        </Grid>                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>                            <TextBlock Text="Port:" VerticalAlignment="Center" Margin="0,0,10,0"
                                      Style="{StaticResource DarkTextBlockStyle}"/>
                            <TextBox Name="PortTextBox" Grid.Column="1" Text="4444" Height="25"
                                    Style="{StaticResource DarkTextBoxStyle}"/>
                        </Grid>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Log File:" VerticalAlignment="Center" Margin="0,0,10,0"
                                      Style="{StaticResource DarkTextBlockStyle}"/>
                            <TextBox Name="LogFileTextBox" Grid.Column="1" Text="tls_proxy.log" Height="25"
                                    Style="{StaticResource DarkTextBoxStyle}"/>
                            <Button Name="BrowseLogFileButton" Content="Browse" Grid.Column="2"
                                    Margin="5,0,0,0" Click="BrowseLogFile_Click" Height="25"
                                    Style="{StaticResource DarkButtonStyle}"/>
                        </Grid>

                        <CheckBox Name="VerboseModeCheckBox" Content="Verbose Mode" Margin="0,0,0,10"
                                 Style="{StaticResource DarkCheckBoxStyle}" />

                        <Button Name="ApplyConfigButton" Content="Apply Configuration" Margin="0,10,0,10"
                                Click="ApplyConfig_Click" Padding="15,8" HorizontalAlignment="Left"
                                Style="{StaticResource DarkButtonStyle}"/>

                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">                            <Button Name="StartProxyButton" Content="Start Proxy" Margin="0,0,10,0"
                                    Click="StartProxy_Click"
                                    Style="{StaticResource GreenButtonStyle}"/>
                            <Button Name="StopProxyButton" Content="Stop Proxy" Margin="0,0,10,0"
                                    Click="StopProxy_Click" IsEnabled="False"
                                    Style="{StaticResource RedButtonStyle}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid></Grid>            <!-- Connections Panel --><Grid Name="ConnectionsPanel" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Connections" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"
                          Style="{StaticResource DarkTextBlockStyle}" Grid.Row="0"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Grid.Row="1">
                    <Button Name="ClearConnectionsButton" Content="Clear Connections" Margin="0,0,10,0"
                           Click="ClearConnections_Click"
                           Style="{StaticResource DarkButtonStyle}"/>
                    <Button Name="ExportConnectionsButton" Content="Export Connections"
                           Click="ExportConnections_Click"
                           Style="{StaticResource DarkButtonStyle}"/>
                </StackPanel>

                <ListView Name="ConnectionsList" Style="{StaticResource DarkListViewStyle}" Grid.Row="2"
                          VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                    <ListView.View>
                        <GridView ColumnHeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn Header="Timestamp" Width="150" DisplayMemberBinding="{Binding Timestamp}"/>
                            <GridViewColumn Header="Event" Width="100" DisplayMemberBinding="{Binding Event}"/>
                            <GridViewColumn Header="Connection ID" Width="100" DisplayMemberBinding="{Binding ConnectionId}"/>
                            <GridViewColumn Header="Source IP" Width="120" DisplayMemberBinding="{Binding SourceIp}"/>
                            <GridViewColumn Header="Source Port" Width="100" DisplayMemberBinding="{Binding SourcePort}"/>
                            <GridViewColumn Header="Destination IP" Width="120" DisplayMemberBinding="{Binding DestinationIp}"/>
                            <GridViewColumn Header="Destination Port" Width="100" DisplayMemberBinding="{Binding DestinationPort}"/>                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>            <!-- Proxy History Panel --><Grid Name="ProxyHistoryPanel" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Proxy History" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"
                          Style="{StaticResource DarkTextBlockStyle}" Grid.Row="0"/>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,10" Grid.Row="1">
                    <Button Name="ClearHistoryButton" Content="Clear History" Margin="0,0,10,0"
                           Click="ClearHistory_Click"
                           Style="{StaticResource DarkButtonStyle}"/>
                    <Button Name="ExportHistoryButton" Content="Export History"
                           Click="ExportHistory_Click"
                           Style="{StaticResource DarkButtonStyle}"/>
                </StackPanel>

                <ListView Name="HistoryList" Style="{StaticResource DarkListViewStyle}" Grid.Row="2"
                          VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                          SelectionChanged="HistoryList_SelectionChanged">
                    <ListView.View>
                        <GridView ColumnHeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn Header="Timestamp" Width="150" DisplayMemberBinding="{Binding Timestamp}"/>
                            <GridViewColumn Header="Source IP" Width="120" DisplayMemberBinding="{Binding SourceIp}"/>
                            <GridViewColumn Header="Destination IP" Width="120" DisplayMemberBinding="{Binding DestinationIp}"/>
                            <GridViewColumn Header="Port" Width="60" DisplayMemberBinding="{Binding Port}"/>
                            <GridViewColumn Header="Type" Width="100" DisplayMemberBinding="{Binding Type}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
                
                <!-- Splitter between history list and data view -->
                <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" 
                              Background="#3F3F46" ResizeBehavior="PreviousAndNext"/>
                
                <!-- Data view pane (similar to Burp Suite) -->
                <TextBox Name="HistoryDataTextBox" Grid.Row="4"
                         Style="{StaticResource DarkTextBoxStyle}"
                         TextWrapping="NoWrap"
                         AcceptsReturn="True"
                         IsReadOnly="True"
                         FontFamily="Consolas"
                         HorizontalScrollBarVisibility="Auto"
                         VerticalScrollBarVisibility="Auto"/>
            </Grid>
        </Grid><!-- Bottom Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource MenuBackground}" BorderBrush="#444444"
               BorderThickness="0,1,0,0">
            <Grid Margin="10,5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Text -->
                <TextBlock Grid.Column="0" Name="StatusText" Text="Ready" VerticalAlignment="Center"
                           Style="{StaticResource DarkTextBlockStyle}"/>

                <!-- Statistics -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                    <TextBlock Text="Active: " VerticalAlignment="Center" Style="{StaticResource DarkTextBlockStyle}"/>
                    <TextBlock Name="ActiveConnectionsText" Text="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource DarkTextBlockStyle}"/>

                    <TextBlock Text="Total: " VerticalAlignment="Center" Style="{StaticResource DarkTextBlockStyle}"/>
                    <TextBlock Name="TotalConnectionsText" Text="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource DarkTextBlockStyle}"/>

                    <TextBlock Text="Sent: " VerticalAlignment="Center" Style="{StaticResource DarkTextBlockStyle}"/>
                    <TextBlock Name="BytesSentText" Text="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource DarkTextBlockStyle}"/>

                    <TextBlock Text="Received: " VerticalAlignment="Center" Style="{StaticResource DarkTextBlockStyle}"/>
                    <TextBlock Name="BytesReceivedText" Text="0" VerticalAlignment="Center" Style="{StaticResource DarkTextBlockStyle}"/>
                </StackPanel>

                <!-- DLL Status -->
                <TextBlock Grid.Column="2" Name="DllStatusText" Text="DLL Status: Not Loaded"
                           VerticalAlignment="Center" Foreground="#C0C0C0"
                           Margin="20,0,20,0"/>

                <!-- Current Time -->
                <TextBlock Grid.Column="3" Name="CurrentTimeText" Text="" VerticalAlignment="Center"
                           Foreground="{StaticResource SecondaryAccent}" Margin="10,0,0,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
